# 国密算法 SM2/SM3

国密算法由国家密码局发布，包含SM1\ SM2\ SM3\ SM4\ SSF33算法;国际算法由美国的安全局发布，是现今最通用的商用算法。SM1 为对称加密。其加密强度与AES相当。该算法不公开，调用该算法时，需要通过加密芯片的接口进行调用。SM2为非对称加密，基于ECC。该算法已公开。由于该算法基于ECC，故其签名速度与秘钥生成速度都快于RSA。ECC 256位（SM2采用的就是ECC 256位的一种）安全强度比RSA 2048位高，但运算速度快于RSA。SM3 消息摘要。可以用MD5作为对比理解。该算法已公开。校验结果为256位。SM4 无线局域网标准的分组数据算法。对称加密，密钥长度和分组长度均为128位。本文仅对公钥密码算法SM2与摘要算法SM3进行简要描述。

# 公钥算法SM2，以及与RSA的对比

## 公钥算法
公钥密码系统与只使用一个密钥的对称传统密码不同，算法是基于数学函数而不是基于替换和置换。公钥密码学是非对称的，它使用两个独立的密钥，即密钥分为公钥和私钥，因此称双密钥体制。双钥体制的公钥可以公开，因此称为公钥算法。
公钥算法的出现，给密码的发展开辟了新的方向。公钥算法虽然已经历了20多年的发展，但仍具有强劲的发展势头，在鉴别系统和密钥交换等安全技术领域起着关键的作用。公钥算法的加密与解密由不同的密钥完成，并且从加密密钥得到解密密钥在计算上是不可行的。通常，公钥算法的两个密钥中任何一个都可以作为加密而另一个用作解密，但不是所有的公钥算法都是如此。
![](/images/pkey_encrypt.png)

![](/images/pkey_decrypt.png)

## SM2
SM2算法由国家密码管理局于2010年12月17日发布，全称为椭圆曲线算法。椭圆曲线并不是椭圆，之所以称为椭圆曲线是因为它们是用三次方程来表示的，并且该方程与计算椭圆周长的方程相似。一般而言，椭圆曲线的三次方程形为：
　　`y2+axy+by=x3+cx2+dx+e` [其中a,b,c,d和e是满足某些条件的实数，因为方程中的指数最高是3，所以我们称之为三次方程，或者说方程的次数为3]。SM2算法使用的方程为：`y2= x3 + ax + b`
SM2算法实现如下：
- 选择Ep(a,b)的元素G,使得G的阶n是一个大素数
- G的阶是指满足nG=O的最小n值
- 秘密选择整数k，计算B=kG，然后公开(p,a,b,G,B)，B为公钥，保密k，k为私钥

加密M：先把消息M变换成为Ep(a,b)中一个点Pm，然后，选择随机数r，计算密文Cm={rG,Pm+rP)，如果r使得rG或者rP为O，则要重新选择r。

解密Cm: (Pm+rP)-k(rG)=Pm+rkG-krG=Pm

SM2算法的安全性基于一个数学难题”离散对数问题ECDLP”实现。
现今对椭圆曲线研究的时间短，经过许多优秀的数学家的努力，至今一直没有找到亚指数级算法。正是由于目前所知求解ECDLP的最好方法是指数级的，这使得我们选用SM2算法作加解密及数字签名时，所要求的密钥长度比RSA要短得多。

## SM2 对比 RSA
RSA算法由Rivest、Shamir、Adleman于1978年首次发表，是迄今为止最容易理解和实现的公钥算法，已经受住了多年深入的攻击，其理论基础是一种特殊的可逆模幂运算，其安全性基于分解大整数的困难性。

RSA算法既可用于加密，又可用于数字签名，已得到广泛采用，并被许多标准化组织(如ISO、ITU、IETF和SWIFT等)接纳。目前许多国家标准仍采用RSA算法或它的变型。

RSA算法的实现如下：
- 实现者寻找出两个大素数p和q
- 实现者计算出n=pq 和φ(n)=(p-1)(q-1)
- 实现者选择一个随机数e (0<e<></e<>
- 实现者使用辗转相除法计算d=e-1(modφ(n))
- 实现者在目录中公开n和e作为公钥

密码分析者攻击RSA体制的关键点在于如何分解n。若分解成功使n=pq，则可以算出φ(n)=(p-1)(q-1)，然后由公开的e，解出秘密的d。所以说RSA算法的安全性基于分解大整数的困难性。

国际的RSA算法和国产的SM2算法的主要特性对比如下：

| 特性 | RSA算法 | SM2算法 |
| ---- | ---- | ---- |
| 计算结构 | 基于特殊的可逆模幂函数 | 基于椭圆曲线 |
| 计算复杂度 | 亚指数级 | 指数级 |
| 密钥生成速度 | 慢 | 较RSA快百倍以上 |
| 解密加密速度 | 一般 | 较快 |
| 安全性难度 | 基于分解大整数的难度 | 基于离散对数问题ECDLP数学难题 |

可见SM2的加密解密速度相较于RSA要快。

更为详细的性能对比见下两表：

| RSA密钥强度 | 椭圆曲线密钥强度 | 攻破时间 |
| ---- | ---- | ---- |
| 512 | 106 | 104， 已攻破 |
| 768 | 132 | 108， 已攻破 |
| 1024 | 160 | 1011 |
| 2048 | 210 | 1020 |

| 算法 | 签名速度 | 验签速度 |
| 1024位RSA | 2792 | 51224 |
| 2048位RSA | 455 | 15122 |
| 256位SM2 | 4095 | 871 |

SM2签名速度快，验签速度慢，与RSA正好相反。但是使用SM2能大大缩小签名的体积，并且有着相同的安全性。